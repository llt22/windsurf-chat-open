* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--vscode-editor-background);
  color: var(--vscode-editor-foreground);
  padding: 12px;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header */
.header { margin-bottom: 16px; }
.header-bar { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: var(--vscode-editor-background); border-radius: 4px; }
.header-left { display: flex; align-items: center; gap: 12px; }
.header h1 { font-size: 15px; font-weight: 600; margin: 0; }
.version { background: var(--vscode-badge-background); padding: 2px 6px; border-radius: 3px; font-size: 11px; color: var(--vscode-descriptionForeground); }
.header-right { display: flex; align-items: center; gap: 8px; }
.header-toggle { margin: 0; }
.toggle-label { font-size: 11px; color: var(--vscode-descriptionForeground); cursor: default; user-select: none; }

/* Empty State */
.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 32px 0; color: var(--vscode-descriptionForeground); font-size: 13px; opacity: 0.6; }
.empty-state.hidden { display: none; }
.empty-icon { font-size: 28px; }

/* Conversation List */
.conv-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

/* Conversation Card */
.conv-card { border: 1px solid var(--vscode-widget-border); border-radius: 6px; padding: 12px; background: var(--vscode-editor-background); animation: cardIn 0.2s ease-out; }
@keyframes cardIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
.conv-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.conv-card-header-left { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
.conv-card-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--vscode-testing-iconPassed); flex-shrink: 0; animation: pulse 1.5s ease-in-out infinite; }
.conv-card-countdown { font-size: 11px; color: var(--vscode-descriptionForeground); opacity: 0.7; white-space: nowrap; }
.conv-card-msg { font-size: 12px; line-height: 1.5; color: var(--vscode-foreground); white-space: pre-wrap; word-break: break-word; padding: 6px 8px; background: var(--vscode-textBlockQuote-background); border-left: 3px solid transparent; border-radius: 2px; max-height: 60px; overflow-y: auto; }
.conv-card-context { margin-bottom: 4px; border-left-color: var(--vscode-textBlockQuote-border, var(--vscode-focusBorder)); opacity: 0.85; }
.conv-card-context::before { content: '\1F464 '; }
.conv-card-prompt { margin-bottom: 4px; border-left-color: var(--vscode-testing-iconPassed, #89d185); }
.conv-card-prompt::before { content: '\1F916 '; }
.conv-card-reply { margin-bottom: 8px; border-left-color: var(--vscode-textLink-foreground, #3794ff); max-height: 120px; font-size: 11px; opacity: 0.85; }
.conv-card-reply::before { content: '\1F4AC '; }
.conv-card-input { width: 100%; min-height: 48px; max-height: 120px; padding: 8px; border: 1px solid var(--vscode-input-border, rgba(128, 128, 128, 0.35)); background: var(--vscode-input-background); color: var(--vscode-input-foreground); border-radius: 4px; font-family: inherit; font-size: 13px; overflow-y: auto; white-space: pre-wrap; word-break: break-word; }
.conv-card-input:focus { outline: 1px solid var(--vscode-focusBorder); }
.conv-card-input:empty:before { content: '输入反馈...Ctrl+Enter 提交 | Esc 结束'; color: var(--vscode-input-placeholderForeground); opacity: 0.6; }
.conv-card-input.drag-over { border-color: var(--vscode-focusBorder); background: var(--vscode-list-dropBackground); }
.conv-card-actions { display: flex; gap: 6px; margin-top: 8px; align-items: center; }
.conv-card-actions .hint { font-size: 11px; color: var(--vscode-descriptionForeground); margin-left: auto; }

/* File Chips */
.file-chip { display: inline-flex; align-items: center; gap: 4px; padding: 2px 6px; margin: 0 2px; background: var(--vscode-badge-background); color: var(--vscode-badge-foreground); border: 1px solid var(--vscode-widget-border); border-radius: 3px; font-size: 12px; cursor: default; user-select: none; vertical-align: middle; white-space: nowrap; }
.file-chip .chip-icon { font-size: 14px; line-height: 1; }
.file-chip .chip-name { max-width: 200px; overflow: hidden; text-overflow: ellipsis; }
.file-chip .chip-delete { margin-left: 2px; cursor: pointer; opacity: 0.7; font-weight: bold; font-size: 14px; line-height: 1; padding: 0 2px; }
.file-chip .chip-delete:hover { opacity: 1; color: var(--vscode-errorForeground); }

/* Buttons */
.buttons { display: flex; gap: 8px; }
button { padding: 6px 12px; border: 1px solid var(--vscode-widget-border); background: transparent; color: var(--vscode-foreground); border-radius: 3px; cursor: pointer; font-size: 12px; opacity: 0.7; transition: opacity 0.2s; }
button:hover { opacity: 1; background: var(--vscode-list-hoverBackground); }
.btn-primary { border-color: var(--vscode-focusBorder); }
.btn-danger { color: var(--vscode-errorForeground); }
.hint { font-size: 11px; color: var(--vscode-descriptionForeground); margin-top: 4px; }

/* Image Preview */
.image-preview { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; padding: 4px; }
.image-preview .img-wrapper { position: relative; display: inline-block; }
.image-preview img { max-width: 60px; max-height: 60px; border-radius: 4px; border: 1px solid var(--vscode-widget-border); display: block; cursor: pointer; }
.image-preview .img-delete { position: absolute; top: -8px; right: -8px; width: 20px; height: 20px; background: #d32f2f; color: white; border: none; border-radius: 50%; cursor: pointer; z-index: 10; padding: 0; display: inline-flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; line-height: 1; }
.image-preview .img-delete:hover { background: #b71c1c; }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center; }
.modal.show { display: flex; }
.modal img { max-width: 90%; max-height: 90%; border-radius: 8px; }
.modal-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; background: none; border: none; }

/* Settings */
.settings-toggle { display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; padding: 0; background: transparent; color: var(--vscode-foreground); border: none; border-radius: 3px; cursor: pointer; font-size: 14px; transition: background 0.1s; opacity: 0.7; }
.settings-toggle:hover { background: var(--vscode-toolbar-hoverBackground); opacity: 1; }
.settings-toggle-icon { transition: transform 0.2s; display: inline-block; }
.settings-toggle.expanded .settings-toggle-icon { transform: rotate(45deg); }
.port-display { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--vscode-descriptionForeground); }
.connection-status { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: var(--vscode-testing-iconPassed); }
.connection-status.disconnected { background: var(--vscode-testing-iconFailed); }

/* Config Bar */
.config-bar { display: none; flex-direction: column; gap: 12px; margin-bottom: 12px; padding: 12px; background: var(--vscode-editor-background); border: 1px solid var(--vscode-widget-border); border-radius: 4px; font-size: 12px; overflow: hidden; max-height: 0; opacity: 0; transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease; }
.config-bar.show { display: flex; max-height: 200px; opacity: 1; }
.config-bar-row { display: flex; align-items: center; gap: 16px; }
.config-item { display: flex; align-items: center; gap: 8px; }
.config-item label { color: var(--vscode-descriptionForeground); }
.config-item input { width: 80px; padding: 4px 8px; border: 1px solid var(--vscode-input-border, rgba(128, 128, 128, 0.35)); background: var(--vscode-input-background); color: var(--vscode-input-foreground); border-radius: 3px; font-size: 12px; }
.config-item input:focus { outline: 1px solid var(--vscode-focusBorder); }
.config-item .hint-text { color: var(--vscode-descriptionForeground); opacity: 0.7; }
.timeout-presets { display: flex; gap: 6px; margin-left: 8px; }
.timeout-preset-btn { padding: 2px 8px; font-size: 11px; border: 1px solid var(--vscode-button-border, transparent); background: var(--vscode-button-secondaryBackground); color: var(--vscode-button-secondaryForeground); border-radius: 3px; cursor: pointer; transition: background 0.1s; }
.timeout-preset-btn:hover { background: var(--vscode-button-secondaryHoverBackground); }
.timeout-preset-btn:active { transform: translateY(1px); }
.confirm-config-btn { padding: 4px 16px; margin-left: auto; font-size: 12px; border: 1px solid var(--vscode-button-border, transparent); background: var(--vscode-button-background); color: var(--vscode-button-foreground); border-radius: 3px; cursor: pointer; transition: background 0.1s; }
.confirm-config-btn:hover { background: var(--vscode-button-hoverBackground); }
.confirm-config-btn:active { transform: translateY(1px); }

/* Toggle Switch */
.toggle-switch { position: relative; display: inline-block; width: 36px; height: 20px; flex-shrink: 0; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--vscode-input-border, rgba(128,128,128,0.35)); border-radius: 10px; transition: background 0.2s; }
.toggle-slider::before { content: ''; position: absolute; height: 14px; width: 14px; left: 3px; bottom: 3px; background: var(--vscode-editor-foreground); border-radius: 50%; transition: transform 0.2s; }
.toggle-switch input:checked + .toggle-slider { background: var(--vscode-focusBorder); }
.toggle-switch input:checked + .toggle-slider::before { transform: translateX(16px); }
